#!/usr/bin/env node
/*!
 * sqlite-parser - v1.0.0-beta2
 * @copyright 2015-2016 Code School (http://codeschool.com)
 * @author Nick Wronski <nick@javascript.com>
 */
'use strict';var _index=require('../lib/index');var _index2=_interopRequireDefault(_index);var _fs=require('fs');var _path=require('path');function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj};}var args=resolveArgs(process.argv.slice(2));if(args['version']){console.log('sqlite-parser v1.0.0-beta2');process.exit(0);}if(args['help']||args._.length===0){console.log('Usage: sqlite-parser infile [--output outfile]');process.exit(0);}var input=(0,_path.normalize)(args._[0]);var output=args['o']||args['output'];if(output){output=(0,_path.normalize)(output);}(0,_fs.stat)(input,function startCallback(err){if(err){return error(err);}(0,_fs.readFile)(input,'utf8',readCallback);});function resolveArgs(argv){var args={_:[]};var last=null;var isNewArg=function isNewArg(arg){return!arg||arg.indexOf('-')===0;};var aliases={o:'output',v:'version',h:'help'};for(var i=0;i<argv.length;i+=1){var arg=argv[i];if(isNewArg(arg)){var cur=arg.indexOf('--')!==-1?arg.slice(2):aliases[arg.slice(1)];var peek=argv.length-1!==i?argv[i+1]:null;var peekNew=isNewArg(peek);args[cur]=peekNew?true:peek;if(!peekNew){i+=1;}}else{args._.push(arg);}}return args;}function error(err){console.error(err.message);process.exit(1);}function writeOut(result,outPath){var outDir=(0,_path.dirname)(outPath);function writeCallback(err){if(err){return error(err);}process.exit(0);}function mkdirCallback(err){if(err){return error(err);}(0,_fs.writeFile)(outPath,result,writeCallback);}function statCallback(err){if(err){return(0,_fs.mkdir)(outDir,mkdirCallback);}mkdirCallback();}(0,_fs.stat)(outDir,statCallback);}function parserCallback(err,ast){if(err){return error(err);}var result=void 0;try{result=JSON.stringify(ast,null,2);}catch(e){return error(e);}if(output){writeOut(result,output);}else{process.stdout.write(result);process.exit(0);}}function readCallback(err,data){if(err){return error(err);}(0,_index2.default)(data,parserCallback);}
