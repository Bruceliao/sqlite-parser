var tree              = require('./helpers');

describe('sqlite-parser', function() {

  // Aliases

  it('aliases', function(done) {
    var resultTree = '{"statement":[{"explain":false,"type":"statement","variant":"select","from":[{"type":"identifier","variant":"table","name":"bananas","alias":"b","index":null}],"where":null,"group":null,"result":[{"type":"identifier","variant":"column","name":"apple","alias":"The Apple"},{"type":"identifier","variant":"column","name":"pear","alias":"the_pear"},{"type":"identifier","variant":"column","name":"orange","alias":"TheOrange"},{"type":"identifier","variant":"column","name":"pineapple","alias":"wherekeyword"}],"distinct":false,"all":false,"order":null,"limit":null,"with":null}]}';
    tree.equals(resultTree, this, done);
  });

  it('aliases non standard', function(done) {
    var resultTree = '{"statement":[{"explain":false,"type":"statement","variant":"select","from":[{"type":"identifier","variant":"table","name":"hats","alias":"hat","index":null}],"where":null,"group":null,"result":[{"type":"identifier","variant":"star","name":"hat.*"},{"type":"function","name":"count","distinct":false,"args":[{"type":"identifier","variant":"star","name":"*"}],"alias":"pants"}],"distinct":false,"all":false,"order":null,"limit":null,"with":null}]}';
    tree.equals(resultTree, this, done);
  });

  // Expressions

  it('expression unary 1', function(done) {
    var resultTree = '{"statement":[{"explain":false,"type":"statement","variant":"select","with":null,"from":[{"type":"identifier","variant":"table","name":"hats","alias":null,"index":null}],"where":null,"group":null,"result":[{"type":"expression","format":"unary","variant":"operation","expression":{"type":"identifier","variant":"column","name":"bees"},"operator":"not","alias":"b"}],"distinct":false,"all":false,"order":null,"limit":null}]}';
    tree.equals(resultTree, this, done);
  });

  it('expression table 1', function(done) {
    var resultTree = '{"statement":[{"explain":false,"type":"statement","variant":"select","from":{"type":"map","variant":"join","source":{"type":"identifier","variant":"table","name":"inventory","alias":null,"index":null},"map":[{"type":"join","variant":"inner join","source":{"type":"identifier","variant":"table","name":"ham","alias":null,"index":null},"constraint":{"type":"constraint","variant":"join","format":"on","on":{"type":"expression","format":"binary","variant":"operation","operation":"=","left":{"type":"identifier","variant":"column","name":"inventory.variety"},"right":{"type":"identifier","variant":"column","name":"ham.type"}}}}]},"where":null,"group":null,"result":[{"type":"identifier","variant":"star","name":"*"}],"distinct":false,"all":false,"order":null,"limit":null,"with":[{"type":"expression","format":"table","variant":"common","target":{"type":"identifier","variant":"table","name":"ham"},"expression":{"type":"statement","variant":"select","from":[{"type":"identifier","variant":"table","name":"hams","alias":null,"index":null}],"where":null,"group":null,"result":[{"type":"identifier","variant":"column","name":"type","alias":null}],"distinct":false,"all":false,"order":null,"limit":null}}]}]}';
    tree.equals(resultTree, this, done);
  });

  it('expression like', function(done) {
    var resultTree = '{"statement":[{"explain":false,"type":"statement","variant":"select","with":null,"from":[{"type":"identifier","variant":"table","name":"hats","alias":null,"index":null}],"where":[{"type":"expression","format":"binary","variant":"operation","operation":"like","left":{"type":"identifier","variant":"column","name":"bees"},"right":{"type":"literal","variant":"string","value":"%somebees%"}}],"group":null,"result":[{"type":"identifier","variant":"star","name":"*"}],"distinct":false,"all":false,"order":null,"limit":null}]}';
    tree.equals(resultTree, this, done);
  });

  it('binary case', function(done) {
    var resultTree = '{"statement":[{"explain":false,"type":"statement","variant":"select","from":[{"type":"identifier","variant":"table","name":"bees","alias":null,"index":null}],"where":null,"group":null,"result":[{"type":"expression","format":"binary","variant":"case","expression":null,"condition":[{"type":"condition","format":"when","when":{"type":"expression","format":"binary","variant":"operation","operation":"=","left":{"type":"identifier","variant":"column","name":"bee"},"right":{"type":"literal","variant":"string","value":"red"}},"then":{"type":"literal","variant":"string","value":"ANGRY"}},{"type":"condition","format":"when","when":{"type":"expression","format":"binary","variant":"operation","operation":"=","left":{"type":"identifier","variant":"column","name":"bee"},"right":{"type":"literal","variant":"string","value":"green"}},"then":{"type":"literal","variant":"string","value":"HAPPY"}},{"type":"condition","format":"else","else":{"type":"literal","variant":"string","value":"NEUTRAL"}}],"alias":"beestate"}],"distinct":false,"all":false,"order":null,"limit":null,"with":null}]}';
    tree.equals(resultTree, this, done);
  });

  it('binary cast', function(done) {
    var resultTree = '{"statement":[{"explain":false,"type":"statement","variant":"select","with":null,"from":[{"type":"identifier","variant":"table","name":"bees","alias":null,"index":null}],"where":null,"group":null,"result":[{"type":"expression","format":"unary","variant":"cast","expression":{"type":"literal","variant":"decimal","value":"430.120"},"as":{"type":"datatype","variant":"varchar","affinity":"text","args":[{"type":"literal","variant":"decimal","value":"20"}]},"alias":null}],"distinct":false,"all":false,"order":null,"limit":null}]}';
    tree.equals(resultTree, this, done);
  });

  it('binary concatenation', function(done) {
    var resultTree = '{"statement":[{"explain":false,"type":"statement","variant":"select","with":null,"from":[{"type":"identifier","variant":"table","name":"bananas","alias":null,"index":null}],"where":[{"type":"expression","format":"binary","variant":"operation","operation":"and","left":{"type":"expression","format":"binary","variant":"operation","operation":"!=","left":{"type":"literal","variant":"decimal","value":"1"},"right":{"type":"literal","variant":"decimal","value":"2"}},"right":{"type":"expression","format":"binary","variant":"operation","operation":"or","left":{"type":"expression","format":"binary","variant":"operation","operation":"!=","left":{"type":"identifier","variant":"column","name":"color"},"right":{"type":"literal","variant":"string","value":"blue"}},"right":{"type":"expression","format":"binary","variant":"operation","operation":"==","left":{"type":"identifier","variant":"column","name":"pees"},"right":{"type":"identifier","variant":"column","name":"crackers"}}}}],"group":null,"result":[{"type":"identifier","variant":"star","name":"*"}],"distinct":false,"all":false,"order":null,"limit":null}]}';
    tree.equals(resultTree, this, done);
  });

  it('expression grouping 1', function(done) {
    var resultTree = '{"statement":[{"explain":false,"type":"statement","variant":"create","format":"index","target":{"type":"identifier","variant":"index","name":"bees.hive_state"},"where":[{"type":"expression","format":"binary","variant":"operation","operation":"and","left":{"type":"expression","format":"binary","variant":"operation","operation":"!=","left":{"type":"identifier","variant":"column","name":"anger"},"right":{"type":"literal","variant":"null","value":"null"}},"right":{"type":"expression","format":"unary","variant":"operation","expression":{"type":"identifier","variant":"column","name":"happiness"},"operator":"not"}}],"on":{"target":"hive","columns":[{"type":"identifier","variant":"column","format":"indexed","direction":"asc","name":"happiness","collate":null},{"type":"identifier","variant":"column","format":"indexed","direction":"desc","name":"anger","collate":null}]},"condition":[],"unique":false}]}';
    tree.equals(resultTree, this, done);
  });

  it('expression grouping 2', function(done) {
    var resultTree = '{"statement":[{"explain":false,"type":"statement","variant":"create","format":"index","target":{"type":"identifier","variant":"index","name":"bees.hive_state"},"where":[{"type":"expression","format":"binary","variant":"operation","operation":"and","left":{"type":"expression","format":"unary","variant":"operation","expression":{"type":"identifier","variant":"column","name":"happiness"},"operation":"not null"},"right":{"type":"expression","format":"binary","variant":"operation","operation":">","left":{"type":"identifier","variant":"column","name":"anger"},"right":{"type":"literal","variant":"decimal","value":"0"}}}],"on":{"target":"hive","columns":[{"type":"identifier","variant":"column","format":"indexed","direction":"asc","name":"happiness","collate":null},{"type":"identifier","variant":"column","format":"indexed","direction":"desc","name":"anger","collate":null}]},"condition":[],"unique":false}]}';
    tree.equals(resultTree, this, done);
  });

  it('expression grouping 3', function(done) {
    var resultTree = '{"statement":[{"explain":false,"type":"statement","variant":"create","format":"index","target":{"type":"identifier","variant":"index","name":"bees.hive_state"},"where":[{"type":"expression","format":"binary","variant":"operation","operation":"and","left":{"type":"expression","format":"binary","variant":"operation","operation":"is not","left":{"type":"identifier","variant":"column","name":"happiness"},"right":{"type":"literal","variant":"null","value":"null"}},"right":{"type":"expression","format":"binary","variant":"operation","operation":">","left":{"type":"identifier","variant":"column","name":"anger"},"right":{"type":"literal","variant":"decimal","value":"0"}}}],"on":{"target":"hive","columns":[{"type":"identifier","variant":"column","format":"indexed","direction":"asc","name":"happiness","collate":null},{"type":"identifier","variant":"column","format":"indexed","direction":"desc","name":"anger","collate":null}]},"condition":[],"unique":false}]}';
    tree.equals(resultTree, this, done);
  });

  it('expression grouping 4', function(done) {
    var resultTree = '{"statement":[{"explain":false,"type":"statement","variant":"create","format":"index","target":{"type":"identifier","variant":"index","name":"bees.hive_state"},"where":[{"type":"expression","format":"binary","variant":"operation","operation":"and","left":{"type":"expression","format":"unary","variant":"operation","expression":{"type":"identifier","variant":"column","name":"happiness"},"operation":"is null"},"right":{"type":"expression","format":"binary","variant":"operation","operation":">","left":{"type":"identifier","variant":"column","name":"anger"},"right":{"type":"literal","variant":"decimal","value":"0"}}}],"on":{"target":"hive","columns":[{"type":"identifier","variant":"column","format":"indexed","direction":"asc","name":"happiness","collate":null},{"type":"identifier","variant":"column","format":"indexed","direction":"desc","name":"anger","collate":null}]},"condition":[],"unique":false}]}';
    tree.equals(resultTree, this, done);
  });

  it('expression grouping 5', function(done) {
    var resultTree = '{"statement":[{"explain":false,"type":"statement","variant":"create","format":"index","target":{"type":"identifier","variant":"index","name":"bees.hive_state"},"where":[{"type":"expression","format":"binary","variant":"operation","operation":"and","left":{"type":"expression","format":"binary","variant":"operation","operation":">","left":{"type":"identifier","variant":"column","name":"anger"},"right":{"type":"literal","variant":"decimal","value":"0"}},"right":{"type":"expression","format":"binary","variant":"operation","operation":"is not","left":{"type":"identifier","variant":"column","name":"happiness"},"right":{"type":"literal","variant":"null","value":"null"}}}],"on":{"target":"hive","columns":[{"type":"identifier","variant":"column","format":"indexed","direction":"asc","name":"happiness","collate":null},{"type":"identifier","variant":"column","format":"indexed","direction":"desc","name":"anger","collate":null}]},"condition":[],"unique":false}]}';
    tree.equals(resultTree, this, done);
  });

  it('expression grouping 6', function(done) {
    var resultTree = '{"statement":[{"explain":false,"type":"statement","variant":"create","format":"index","target":{"type":"identifier","variant":"index","name":"bees.hive_state"},"where":[{"type":"expression","format":"binary","variant":"operation","operation":"and","left":{"type":"expression","format":"unary","variant":"operation","expression":{"type":"identifier","variant":"column","name":"happiness"},"operator":"not"},"right":{"type":"expression","format":"binary","variant":"operation","operation":">","left":{"type":"identifier","variant":"column","name":"anger"},"right":{"type":"literal","variant":"decimal","value":"0"}}}],"on":{"target":"hive","columns":[{"type":"identifier","variant":"column","format":"indexed","direction":"asc","name":"happiness","collate":null},{"type":"identifier","variant":"column","format":"indexed","direction":"desc","name":"anger","collate":null}]},"condition":[],"unique":false}]}';
    tree.equals(resultTree, this, done);
  });

  it('expression grouping 7', function(done) {
    var resultTree = '{"statement":[{"explain":false,"type":"statement","variant":"create","format":"index","target":{"type":"identifier","variant":"index","name":"bees.hive_state"},"where":[{"type":"expression","format":"binary","variant":"operation","operation":"or","left":{"type":"expression","format":"unary","variant":"operation","expression":{"type":"identifier","variant":"column","name":"happiness"},"operator":"not"},"right":{"type":"expression","format":"binary","variant":"operation","operation":"and","left":{"type":"expression","format":"unary","variant":"operation","expression":{"type":"identifier","variant":"column","name":"ANGER"},"operator":"~"},"right":{"type":"expression","format":"binary","variant":"operation","operation":"is not","left":{"type":"identifier","variant":"column","name":"anger"},"right":{"type":"literal","variant":"decimal","value":"0"}}}}],"on":{"target":"hive","columns":[{"type":"identifier","variant":"column","format":"indexed","direction":"asc","name":"happiness","collate":null},{"type":"identifier","variant":"column","format":"indexed","direction":"desc","name":"anger","collate":null}]},"condition":[],"unique":false}]}';
    tree.equals(resultTree, this, done);
  });

  it('expression parenthesis 1', function(done) {
    var resultTree = '{"statement":[{"explain":false,"type":"statement","variant":"select","with":null,"from":[{"type":"identifier","variant":"table","name":"hats","alias":null,"index":null}],"where":[{"type":"expression","format":"binary","variant":"operation","operation":"or","left":{"type":"identifier","variant":"column","name":"hat"},"right":{"type":"expression","format":"binary","variant":"operation","operation":"and","left":{"type":"identifier","variant":"column","name":"shirt"},"right":{"type":"expression","format":"binary","variant":"operation","operation":"and","left":{"type":"expression","format":"binary","variant":"operation","operation":"or","left":{"type":"identifier","variant":"column","name":"shoes"},"right":{"type":"identifier","variant":"column","name":"wig"}},"right":{"type":"identifier","variant":"column","name":"pants"}}}}],"group":null,"result":[{"type":"identifier","variant":"star","name":"*"}],"distinct":false,"all":false,"order":null,"limit":null}]}';
    tree.equals(resultTree, this, done);
  });

  it('expression parenthesis 2', function(done) {
    var resultTree = '{"statement":[{"explain":false,"type":"statement","variant":"select","with":null,"from":[{"type":"identifier","variant":"table","name":"hats","alias":null,"index":null}],"where":[{"type":"expression","format":"binary","variant":"operation","operation":"and","left":{"type":"expression","format":"binary","variant":"operation","operation":"or","left":{"type":"expression","format":"binary","variant":"operation","operation":"!=","left":{"type":"literal","variant":"decimal","value":"1"},"right":{"type":"literal","variant":"decimal","value":"2"}},"right":{"type":"expression","format":"binary","variant":"operation","operation":"!=","left":{"type":"literal","variant":"decimal","value":"3"},"right":{"type":"literal","variant":"decimal","value":"4"}}},"right":{"type":"expression","format":"binary","variant":"operation","operation":"==","left":{"type":"literal","variant":"decimal","value":"3"},"right":{"type":"literal","variant":"decimal","value":"3"}}}],"group":null,"result":[{"type":"identifier","variant":"star","name":"*"}],"distinct":false,"all":false,"order":null,"limit":null}]}';
    tree.equals(resultTree, this, done);
  });

  it('with table expression 1', function(done) {
    var resultTree = '{"statement":[{"explain":false,"type":"statement","variant":"select","from":[{"type":"identifier","variant":"table","name":"nick","alias":null,"index":null}],"where":null,"group":null,"result":[{"type":"identifier","variant":"star","name":"*"}],"distinct":false,"all":false,"order":null,"limit":null,"with":[{"type":"expression","format":"table","variant":"recursive","target":{"type":"identifier","variant":"expression","format":"table","name":"hat","columns":[{"type":"identifier","variant":"column","name":"hat"},{"type":"identifier","variant":"column","name":"pants"}]},"expression":{"type":"statement","variant":"select","from":[{"type":"identifier","variant":"table","name":"hats","alias":null,"index":null}],"where":null,"group":null,"result":[{"type":"identifier","variant":"star","name":"*"}],"distinct":false,"all":false,"order":null,"limit":null}},{"type":"expression","format":"table","variant":"recursive","target":{"type":"identifier","variant":"table","name":"pant"},"expression":{"type":"statement","variant":"select","from":[{"type":"identifier","variant":"table","name":"pants","alias":null,"index":null}],"where":null,"group":null,"result":[{"type":"identifier","variant":"star","name":"*"}],"distinct":false,"all":false,"order":null,"limit":null}},{"type":"expression","format":"table","variant":"recursive","target":{"type":"identifier","variant":"expression","format":"table","name":"nap","columns":[{"type":"identifier","variant":"column","name":"a"}]},"expression":{"type":"statement","variant":"select","from":[{"type":"identifier","variant":"table","name":"naps","alias":null,"index":null}],"where":null,"group":null,"result":[{"type":"identifier","variant":"column","name":"sleep","alias":null}],"distinct":false,"all":false,"order":null,"limit":null}}]}]}';
    tree.equals(resultTree, this, done);
  });

  it('with table expression 2', function(done) {
    var resultTree = '{"statement":[{"explain":false,"type":"statement","variant":"select","from":[{"type":"identifier","variant":"table","name":"ancestor_of_alice","alias":null,"index":null},{"type":"identifier","variant":"table","name":"family","alias":null,"index":null}],"where":[{"type":"expression","format":"binary","variant":"operation","operation":"and","left":{"type":"expression","format":"binary","variant":"operation","operation":"=","left":{"type":"identifier","variant":"column","name":"ancestor_of_alice.name"},"right":{"type":"identifier","variant":"column","name":"family.name"}},"right":{"type":"expression","format":"binary","variant":"operation","operation":"is","left":{"type":"identifier","variant":"column","name":"died"},"right":{"type":"literal","variant":"null","value":"null"}}}],"group":null,"result":[{"type":"identifier","variant":"column","name":"family.name","alias":null}],"distinct":false,"all":false,"order":[{"direction":"","expression":{"type":"identifier","variant":"column","name":"born"},"collate":null}],"limit":null,"with":[{"type":"expression","format":"table","variant":"recursive","target":{"type":"identifier","variant":"expression","format":"table","name":"parent_of","columns":[{"type":"identifier","variant":"column","name":"name"},{"type":"identifier","variant":"column","name":"parent"}]},"expression":{"type":"statement","variant":"compound","statement":{"type":"statement","variant":"select","from":[{"type":"identifier","variant":"table","name":"family","alias":null,"index":null}],"where":null,"group":null,"result":[{"type":"identifier","variant":"column","name":"name","alias":null},{"type":"identifier","variant":"column","name":"mom","alias":null}],"distinct":false,"all":false},"compound":[{"type":"compound","variant":"union","statement":{"type":"statement","variant":"select","from":[{"type":"identifier","variant":"table","name":"family","alias":null,"index":null}],"where":null,"group":null,"result":[{"type":"identifier","variant":"column","name":"name","alias":null},{"type":"identifier","variant":"column","name":"dad","alias":null}],"distinct":false,"all":false}}],"order":null,"limit":null}},{"type":"expression","format":"table","variant":"recursive","target":{"type":"identifier","variant":"expression","format":"table","name":"ancestor_of_alice","columns":[{"type":"identifier","variant":"column","name":"name"}]},"expression":{"type":"statement","variant":"compound","statement":{"type":"statement","variant":"select","from":[{"type":"identifier","variant":"table","name":"parent_of","alias":null,"index":null}],"where":[{"type":"expression","format":"binary","variant":"operation","operation":"=","left":{"type":"identifier","variant":"column","name":"name"},"right":{"type":"literal","variant":"string","value":"Alice"}}],"group":null,"result":[{"type":"identifier","variant":"column","name":"parent","alias":null}],"distinct":false,"all":false},"compound":[{"type":"compound","variant":"union all","statement":{"type":"statement","variant":"select","from":{"type":"map","variant":"join","source":{"type":"identifier","variant":"table","name":"parent_of","alias":null,"index":null},"map":[{"type":"join","variant":"join","source":{"type":"identifier","variant":"table","name":"ancestor_of_alice","alias":null,"index":null},"constraint":{"type":"constraint","variant":"join","format":"using","using":{"columns":[{"type":"identifier","variant":"column","name":"name"}]}}}]},"where":null,"group":null,"result":[{"type":"identifier","variant":"column","name":"parent","alias":null}],"distinct":false,"all":false}}],"order":null,"limit":null}}]}]}';
    tree.equals(resultTree, this, done);
  });

  // SELECT statement

  it('basic select', function(done) {
    var resultTree = '{"statement":[{"explain":false,"type":"statement","variant":"select","with":null,"from":[{"type":"identifier","variant":"table","name":"bananas","alias":null,"index":null}],"where":[{"type":"expression","format":"binary","variant":"operation","operation":"=","left":{"type":"identifier","variant":"column","name":"color"},"right":{"type":"literal","variant":"string","value":"red"}}],"group":null,"result":[{"type":"identifier","variant":"star","name":"*"}],"distinct":false,"all":false,"order":null,"limit":null}]}';
    tree.equals(resultTree, this, done);
  });

  it('select alt syntax', function(done) {
    var resultTree = '{"statement":[{"explain":false,"type":"statement","variant":"select","with":null,"result":[{"type":"values","variant":"list","values":[{"type":"literal","variant":"decimal","value":"1"},{"type":"literal","variant":"decimal","value":"2"},{"type":"literal","variant":"decimal","value":"3"}]},{"type":"values","variant":"list","values":[{"type":"literal","variant":"decimal","value":"4"},{"type":"literal","variant":"decimal","value":"5"},{"type":"literal","variant":"decimal","value":"6"}]}],"from":null,"where":null,"group":null,"order":[{"direction":"desc","expression":{"type":"identifier","variant":"column","name":"ham"},"collate":null}],"limit":null}]}';
    tree.equals(resultTree, this, done);
  });

  it('select parts 1', function(done) {
    var resultTree = '{"statement":[{"explain":false,"type":"statement","variant":"select","from":[{"type":"identifier","variant":"table","name":"hats","alias":"h","index":null}],"where":[{"type":"expression","format":"binary","variant":"operation","operation":"==","left":{"type":"identifier","variant":"column","name":"h.color"},"right":{"type":"literal","variant":"string","value":"red"}}],"group":{"expression":[{"type":"identifier","variant":"column","name":"h.color"},{"type":"identifier","variant":"column","name":"h.material"}],"having":{"type":"expression","format":"binary","variant":"operation","operation":">=","left":{"type":"function","name":"count","distinct":false,"args":[{"type":"identifier","variant":"column","name":"h.quantity"}]},"right":{"type":"literal","variant":"decimal","value":"200"}}},"result":[{"type":"identifier","variant":"star","name":"*"}],"distinct":false,"all":false,"order":[{"direction":"desc","expression":{"type":"identifier","variant":"column","name":"h.color"},"collate":null}],"limit":{"start":{"type":"literal","variant":"decimal","value":"20"},"offset":{"type":"literal","variant":"decimal","value":"10"}},"with":null}]}';
    tree.equals(resultTree, this, done);
  });

  it('basic subquery', function(done) {
    var resultTree = '{"statement":[{"explain":false,"type":"statement","variant":"select","from":{"type":"map","variant":"join","source":{"alias":"z","type":"statement","variant":"select","from":[{"type":"identifier","variant":"table","name":"bananas","alias":"b","index":null}],"where":null,"group":null,"result":[{"type":"identifier","variant":"column","name":"b.color","alias":null}],"distinct":false,"all":false,"order":null,"limit":null},"map":[{"type":"join","variant":"join","source":{"type":"identifier","variant":"table","name":"apples","alias":"a","index":null},"constraint":{"type":"constraint","variant":"join","format":"on","on":{"type":"expression","format":"binary","variant":"operation","operation":"=","left":{"type":"identifier","variant":"column","name":"a.color"},"right":{"type":"identifier","variant":"column","name":"b.color"}}}}]},"where":null,"group":null,"result":[{"type":"identifier","variant":"column","name":"a.color","alias":null}],"distinct":false,"all":false,"order":null,"limit":null,"with":null}]}';
    tree.equals(resultTree, this, done);
  });

  it('basic union', function(done) {
    var resultTree = '{"statement":[{"explain":false,"type":"statement","variant":"compound","with":null,"statement":{"type":"statement","variant":"select","from":[{"type":"identifier","variant":"table","name":"a","alias":null,"index":null}],"where":null,"group":null,"result":[{"type":"identifier","variant":"star","name":"*"}],"distinct":false,"all":false},"compound":[{"type":"compound","variant":"union","statement":{"type":"statement","variant":"select","from":[{"type":"identifier","variant":"table","name":"b","alias":null,"index":null}],"where":null,"group":null,"result":[{"type":"identifier","variant":"star","name":"*"}],"distinct":false,"all":false}}],"order":null,"limit":null}]}';
    tree.equals(resultTree, this, done);
  });

  it('select qualified table 1', function(done) {
    var resultTree = '{"statement":[{"explain":false,"type":"statement","variant":"select","with":null,"from":[{"type":"identifier","variant":"table","name":"bees","alias":"b","index":"bees_index"}],"where":null,"group":null,"result":[{"type":"identifier","variant":"star","name":"*"}],"distinct":false,"all":false,"order":null,"limit":null}]}';
    tree.equals(resultTree, this, done);
  });

  // Functions

  it('basic function', function(done) {
    var resultTree = '{"statement":[{"explain":false,"type":"statement","variant":"select","from":[{"type":"identifier","variant":"table","name":"apples","alias":null,"index":null}],"where":null,"group":null,"result":[{"type":"function","name":"count","distinct":false,"args":[{"type":"identifier","variant":"star","name":"*"}],"alias":null},{"type":"function","name":"max","distinct":false,"args":[{"type":"identifier","variant":"column","name":"price"}],"alias":null}],"distinct":false,"all":false,"order":null,"limit":null,"with":null}]}';
    tree.equals(resultTree, this, done);
  });

  it('function mixed args', function(done) {
    var resultTree = '{"statement":[{"explain":false,"type":"statement","variant":"select","from":[],"where":null,"group":null,"result":[{"type":"function","name":"myfunc","distinct":false,"args":[{"type":"identifier","variant":"column","name":"col"},{"type":"literal","variant":"decimal","value":"1.2"},{"type":"literal","variant":"string","value":"str"}],"alias":"Super Func"}],"distinct":false,"all":false,"order":null,"limit":null,"with":null}]}';
    tree.equals(resultTree, this, done);
  });

  // Join Types

  it('join types 1', function(done) {
    var resultTree = '{"statement":[{"explain":false,"type":"statement","variant":"select","from":{"type":"map","variant":"join","source":{"type":"identifier","variant":"table","name":"movies","alias":"m","index":null},"map":[{"type":"join","variant":"inner join","source":{"alias":"r","type":"statement","variant":"select","from":[{"type":"identifier","variant":"table","name":"rooms","alias":"r2","index":null}],"where":[{"type":"expression","format":"binary","variant":"operation","operation":">=","left":{"type":"identifier","variant":"column","name":"r2.seats"},"right":{"type":"literal","variant":"decimal","value":"50"}}],"group":null,"result":[{"type":"identifier","variant":"column","name":"r2.movie_id","alias":null}],"distinct":false,"all":false,"order":null,"limit":null},"constraint":{"type":"constraint","variant":"join","format":"on","on":{"type":"expression","format":"binary","variant":"operation","operation":"and","left":{"type":"expression","format":"binary","variant":"operation","operation":"=","left":{"type":"identifier","variant":"column","name":"m.id"},"right":{"type":"identifier","variant":"column","name":"r.movie_id"}},"right":{"type":"expression","format":"binary","variant":"operation","operation":"!=","left":{"type":"identifier","variant":"column","name":"m.title"},"right":{"type":"literal","variant":"string","value":"Batman"}}}}}]},"where":null,"group":null,"result":[{"type":"identifier","variant":"column","name":"m.title","alias":null},{"type":"identifier","variant":"column","name":"r.id","alias":"Theatre Number"}],"distinct":false,"all":false,"order":null,"limit":null,"with":null}]}';
    tree.equals(resultTree, this, done);
  });

  it('join types 2', function(done) {
    var resultTree = '{"statement":[{"explain":false,"type":"statement","variant":"select","from":{"type":"map","variant":"join","source":{"type":"identifier","variant":"table","name":"movies","alias":"m","index":null},"map":[{"type":"join","variant":"left outer join","source":{"type":"identifier","variant":"table","name":"rooms","alias":"r","index":null},"constraint":{"type":"constraint","variant":"join","format":"on","on":{"type":"expression","format":"binary","variant":"operation","operation":"=","left":{"type":"identifier","variant":"column","name":"m.id"},"right":{"type":"identifier","variant":"column","name":"r.movie_id"}}}}]},"where":null,"group":null,"result":[{"type":"identifier","variant":"column","name":"m.title","alias":null},{"type":"identifier","variant":"column","name":"r.id","alias":"Theatre Number"}],"distinct":false,"all":false,"order":null,"limit":null,"with":null}]}';
    tree.equals(resultTree, this, done);
  });

  // Datatypes

  it('datatypes', function(done) {
    var resultTree = '{"statement":[{"explain":false,"type":"statement","variant":"select","from":[{"type":"identifier","variant":"table","name":"ALL_DATATYPES","alias":null,"index":null}],"where":null,"group":null,"result":[{"type":"expression","format":"unary","variant":"cast","expression":{"type":"identifier","variant":"column","name":"a"},"as":{"type":"datatype","variant":"nvarchar","affinity":"text","args":[{"type":"literal","variant":"decimal","value":"20"}]},"alias":"a1"},{"type":"expression","format":"unary","variant":"cast","expression":{"type":"identifier","variant":"column","name":"b"},"as":{"type":"datatype","variant":"varchar","affinity":"text","args":[{"type":"literal","variant":"decimal","value":"10"}]},"alias":"b1"},{"type":"expression","format":"unary","variant":"cast","expression":{"type":"identifier","variant":"column","name":"c"},"as":{"type":"datatype","variant":"char","affinity":"text","args":[{"type":"literal","variant":"decimal","value":"4"}]},"alias":"c1"},{"type":"expression","format":"unary","variant":"cast","expression":{"type":"identifier","variant":"column","name":"d"},"as":{"type":"datatype","variant":"tinytext","affinity":"text","args":[]},"alias":"d1"},{"type":"expression","format":"unary","variant":"cast","expression":{"type":"identifier","variant":"column","name":"e"},"as":{"type":"datatype","variant":"mediumtext","affinity":"text","args":[]},"alias":"e1"},{"type":"expression","format":"unary","variant":"cast","expression":{"type":"identifier","variant":"column","name":"f"},"as":{"type":"datatype","variant":"longtext","affinity":"text","args":[]},"alias":"f1"},{"type":"expression","format":"unary","variant":"cast","expression":{"type":"identifier","variant":"column","name":"g"},"as":{"type":"datatype","variant":"clob","affinity":"text","args":[{"type":"literal","variant":"decimal","value":"400"}]},"alias":"g1"},{"type":"expression","format":"unary","variant":"cast","expression":{"type":"identifier","variant":"column","name":"h"},"as":{"type":"datatype","variant":"double precision","affinity":"real","args":[]},"alias":"h1"},{"type":"expression","format":"unary","variant":"cast","expression":{"type":"identifier","variant":"column","name":"i"},"as":{"type":"datatype","variant":"double","affinity":"real","args":[]},"alias":"i1"},{"type":"expression","format":"unary","variant":"cast","expression":{"type":"identifier","variant":"column","name":"j"},"as":{"type":"datatype","variant":"float","affinity":"real","args":[]},"alias":"j1"},{"type":"expression","format":"unary","variant":"cast","expression":{"type":"identifier","variant":"column","name":"k"},"as":{"type":"datatype","variant":"real","affinity":"real","args":[]},"alias":"k1"},{"type":"expression","format":"unary","variant":"cast","expression":{"type":"identifier","variant":"column","name":"l"},"as":{"type":"datatype","variant":"numeric","affinity":"numeric","args":[]},"alias":"l1"},{"type":"expression","format":"unary","variant":"cast","expression":{"type":"identifier","variant":"column","name":"m"},"as":{"type":"datatype","variant":"decimal","affinity":"numeric","args":[{"type":"literal","variant":"decimal","value":"6"},{"type":"literal","variant":"decimal","value":"2"}]},"alias":"m1"},{"type":"expression","format":"unary","variant":"cast","expression":{"type":"identifier","variant":"column","name":"n"},"as":{"type":"datatype","variant":"boolean","affinity":"numeric","args":[]},"alias":"n1"},{"type":"expression","format":"unary","variant":"cast","expression":{"type":"identifier","variant":"column","name":"o"},"as":{"type":"datatype","variant":"date","affinity":"numeric","args":[]},"alias":"o1"},{"type":"expression","format":"unary","variant":"cast","expression":{"type":"identifier","variant":"column","name":"p"},"as":{"type":"datatype","variant":"datetime","affinity":"numeric","args":[]},"alias":"p1"},{"type":"expression","format":"unary","variant":"cast","expression":{"type":"identifier","variant":"column","name":"q"},"as":{"type":"datatype","variant":"timestamp","affinity":"numeric","args":[]},"alias":"q1"},{"type":"expression","format":"unary","variant":"cast","expression":{"type":"identifier","variant":"column","name":"r"},"as":{"type":"datatype","variant":"time","affinity":"numeric","args":[]},"alias":"r1"},{"type":"expression","format":"unary","variant":"cast","expression":{"type":"identifier","variant":"column","name":"s"},"as":{"type":"datatype","variant":"int","affinity":"integer","args":[]},"alias":"s1"},{"type":"expression","format":"unary","variant":"cast","expression":{"type":"identifier","variant":"column","name":"t"},"as":{"type":"datatype","variant":"integer","affinity":"integer","args":[]},"alias":"t1"},{"type":"expression","format":"unary","variant":"cast","expression":{"type":"identifier","variant":"column","name":"u"},"as":{"type":"datatype","variant":"int4","affinity":"integer","args":[]},"alias":"u1"},{"type":"expression","format":"unary","variant":"cast","expression":{"type":"identifier","variant":"column","name":"v"},"as":{"type":"datatype","variant":"bigint","affinity":"integer","args":[]},"alias":"v1"},{"type":"expression","format":"unary","variant":"cast","expression":{"type":"identifier","variant":"column","name":"w"},"as":{"type":"datatype","variant":"mediumint","affinity":"integer","args":[]},"alias":"w1"},{"type":"expression","format":"unary","variant":"cast","expression":{"type":"identifier","variant":"column","name":"x"},"as":{"type":"datatype","variant":"smallint","affinity":"integer","args":[]},"alias":"x1"},{"type":"expression","format":"unary","variant":"cast","expression":{"type":"identifier","variant":"column","name":"y"},"as":{"type":"datatype","variant":"tinyint","affinity":"integer","args":[]},"alias":"y1"},{"type":"expression","format":"unary","variant":"cast","expression":{"type":"identifier","variant":"column","name":"z"},"as":{"type":"datatype","variant":"blob","affinity":"none","args":[]},"alias":"z1"}],"distinct":false,"all":false,"order":null,"limit":null,"with":null},{"explain":false,"type":"statement","name":{"type":"identifier","variant":"table","name":"MORE_DATATYPES"},"condition":[],"optimization":[],"definition":[{"type":"definition","variant":"column","name":{"type":"identifier","variant":"column","name":"a"},"definition":[{"name":null,"type":"constraint","variant":"not null","conflict":null}],"datatype":{"type":"datatype","variant":"varchar","affinity":"text","args":[{"type":"literal","variant":"decimal","value":"20"}]}},{"type":"definition","variant":"column","name":{"type":"identifier","variant":"column","name":"b"},"definition":[{"name":null,"type":"constraint","variant":"null","conflict":null}],"datatype":{"type":"datatype","variant":"text","affinity":"text","args":[]}},{"type":"definition","variant":"column","name":{"type":"identifier","variant":"column","name":"c"},"definition":[{"name":null,"type":"constraint","variant":"not null","conflict":null}],"datatype":{"type":"datatype","variant":"int8","affinity":"integer","args":[]}},{"type":"definition","variant":"column","name":{"type":"identifier","variant":"column","name":"d"},"definition":[{"name":null,"type":"constraint","variant":"null","conflict":null}],"datatype":{"type":"datatype","variant":"double","affinity":"real","args":[]}},{"type":"definition","variant":"column","name":{"type":"identifier","variant":"column","name":"e"},"definition":[{"name":null,"type":"constraint","variant":"null","conflict":null}],"datatype":{"type":"datatype","variant":"blob","affinity":"none","args":[]}}],"temporary":false,"variant":"create","format":"table"}]}';
    this.timeout(8000);
    tree.equals(resultTree, this, done);
  });

  // UPDATE Statement

  it('basic update', function(done) {
    var resultTree = '{"statement":[{"explain":false,"type":"statement","variant":"update","with":null,"into":{"type":"identifier","variant":"table","name":"bees","alias":null,"index":null},"where":[{"type":"expression","format":"binary","variant":"operation","operation":"not in","left":{"type":"identifier","variant":"column","name":"name"},"right":{"type":"statement","variant":"select","from":[{"type":"identifier","variant":"table","name":"bee_names","alias":null,"index":null}],"where":[{"type":"expression","format":"binary","variant":"operation","operation":"<","left":{"type":"identifier","variant":"column","name":"size"},"right":{"type":"literal","variant":"decimal","value":"3.14"}}],"group":null,"result":[{"type":"identifier","variant":"column","name":"name","alias":null}],"distinct":false,"all":false,"order":null,"limit":null}}],"set":[{"type":"assignment","target":{"type":"identifier","variant":"column","name":"name"},"value":{"type":"literal","variant":"string","value":"drone"}},{"type":"assignment","target":{"type":"identifier","variant":"column","name":"wings"},"value":{"type":"literal","variant":"decimal","value":"2"}}],"order":null,"limit":null}]}';
    tree.equals(resultTree, this, done);
  });

  it('update limit', function(done) {
    var resultTree = '{"statement":[{"explain":false,"type":"statement","variant":"update","with":null,"into":{"type":"identifier","variant":"table","name":"bees","alias":null,"index":null},"where":[{"type":"expression","format":"binary","variant":"operation","operation":"!=","left":{"type":"identifier","variant":"column","name":"name"},"right":{"type":"literal","variant":"string","value":"nicholas"}}],"set":[{"type":"assignment","target":{"type":"identifier","variant":"column","name":"name"},"value":{"type":"literal","variant":"string","value":"drone"}},{"type":"assignment","target":{"type":"identifier","variant":"column","name":"wings"},"value":{"type":"literal","variant":"decimal","value":"2"}}],"order":null,"limit":{"start":{"type":"literal","variant":"decimal","value":"2"},"offset":{"type":"literal","variant":"decimal","value":"10"}}}]}';
    tree.equals(resultTree, this, done);
  });

  // DELETE Statement

  it('basic delete', function(done) {
    var resultTree = '{"statement":[{"explain":false,"type":"statement","variant":"delete","with":null,"from":{"type":"identifier","variant":"table","name":"bees","alias":null,"index":null},"where":[{"type":"expression","format":"binary","variant":"operation","operation":"or","left":{"type":"expression","format":"binary","variant":"operation","operation":"=","left":{"type":"identifier","variant":"column","name":"status"},"right":{"type":"literal","variant":"string","value":"stung"}},"right":{"type":"expression","format":"binary","variant":"operation","operation":"=","left":{"type":"identifier","variant":"column","name":"status"},"right":{"type":"literal","variant":"string","value":"eaten"}}}],"order":null,"limit":null}]}';
    tree.equals(resultTree, this, done);
  });

  it('delete limit', function(done) {
    var resultTree = '{"statement":[{"explain":false,"type":"statement","variant":"delete","with":null,"from":{"type":"identifier","variant":"table","name":"bees","alias":null,"index":null},"where":[{"type":"expression","format":"binary","variant":"operation","operation":"or","left":{"type":"expression","format":"binary","variant":"operation","operation":"=","left":{"type":"identifier","variant":"column","name":"status"},"right":{"type":"literal","variant":"string","value":"stung"}},"right":{"type":"expression","format":"binary","variant":"operation","operation":"=","left":{"type":"identifier","variant":"column","name":"status"},"right":{"type":"literal","variant":"string","value":"eaten"}}}],"order":null,"limit":{"start":{"type":"literal","variant":"decimal","value":"10"},"offset":{"type":"literal","variant":"decimal","value":"5"}}}]}';
    tree.equals(resultTree, this, done);
  });

  // INSERT Statement

  it('basic insert', function(done) {
    var resultTree = '{"statement":[{"explain":false,"type":"statement","variant":"insert","into":{"type":"identifier","variant":"expression","format":"table","name":"concessions","columns":[{"type":"identifier","variant":"column","name":"item"},{"type":"identifier","variant":"column","name":"size"},{"type":"identifier","variant":"column","name":"id"},{"type":"identifier","variant":"column","name":"price"}]},"action":"insert","or":null,"result":[{"type":"values","variant":"list","values":[{"type":"literal","variant":"string","value":"Nachos"},{"type":"literal","variant":"string","value":"Regular"},{"type":"literal","variant":"null","value":"null"},{"type":"literal","variant":"null","value":"null"}]},{"type":"values","variant":"list","values":[{"type":"literal","variant":"string","value":"Pizza"},{"type":"literal","variant":"null","value":"null"},{"type":"literal","variant":"decimal","value":"8"},{"type":"literal","variant":"decimal","value":"2.00"}]}],"with":null}]}';
    tree.equals(resultTree, this, done);
  });

  it('insert into select', function(done) {
    var resultTree = '{"statement":[{"explain":false,"type":"statement","variant":"insert","into":{"type":"identifier","variant":"expression","format":"table","name":"foods","columns":[{"type":"identifier","variant":"column","name":"item"},{"type":"identifier","variant":"column","name":"size"},{"type":"identifier","variant":"column","name":"id"},{"type":"identifier","variant":"column","name":"price"}]},"action":"insert","or":null,"result":{"type":"statement","variant":"select","from":[{"type":"identifier","variant":"table","name":"bananas","alias":null,"index":null}],"where":[{"type":"expression","format":"binary","variant":"operation","operation":"!=","left":{"type":"identifier","variant":"column","name":"color"},"right":{"type":"literal","variant":"string","value":"red"}}],"group":null,"result":[{"type":"literal","variant":"string","value":"banana","alias":null},{"type":"identifier","variant":"column","name":"size","alias":null},{"type":"literal","variant":"null","value":"null","alias":null},{"type":"identifier","variant":"column","name":"price","alias":null}],"distinct":false,"all":false,"order":null,"limit":null},"with":null}]}';
    tree.equals(resultTree, this, done);
  });

  it('insert into default', function(done) {
    var resultTree = '{"statement":[{"explain":false,"type":"statement","variant":"insert","into":{"type":"identifier","variant":"expression","format":"table","name":"apples","columns":[{"type":"identifier","variant":"column","name":"a"},{"type":"identifier","variant":"column","name":"b"},{"type":"identifier","variant":"column","name":"c"}]},"action":"insert","or":null,"result":{"type":"values","variant":"default","values":null},"with":null}]}';
    tree.equals(resultTree, this, done);
  });

  // CREATE TABLE statement

  it('basic create table', function(done) {
    var resultTree = '{"statement":[{"explain":false,"type":"statement","name":{"type":"identifier","variant":"table","name":"advertisements"},"condition":[],"optimization":[],"definition":[{"type":"definition","variant":"column","name":{"type":"identifier","variant":"column","name":"id"},"definition":[{"name":null,"type":"constraint","variant":"primary key","conflict":null,"direction":null,"modififer":null,"autoIncrement":false}],"datatype":{"type":"datatype","variant":"int","affinity":"integer","args":[]}},{"type":"definition","variant":"column","name":{"type":"identifier","variant":"column","name":"name"},"definition":[],"datatype":{"type":"datatype","variant":"varchar","affinity":"text","args":[{"type":"literal","variant":"decimal","value":"50"}]}},{"type":"definition","variant":"column","name":{"type":"identifier","variant":"column","name":"category"},"definition":[],"datatype":{"type":"datatype","variant":"varchar","affinity":"text","args":[{"type":"literal","variant":"decimal","value":"15"}]}},{"type":"definition","variant":"column","name":{"type":"identifier","variant":"column","name":"cost"},"definition":[],"datatype":{"type":"datatype","variant":"int","affinity":"integer","args":[]}}],"temporary":false,"variant":"create","format":"table"}]}';
    tree.equals(resultTree, this, done);
  });

  it('create table alt syntax', function(done) {
    var resultTree = '{"statement":[{"explain":false,"type":"statement","name":{"type":"identifier","variant":"table","name":"bees"},"condition":[],"optimization":null,"definition":[{"type":"statement","variant":"select","from":[{"type":"identifier","variant":"table","name":"old_bees","alias":null,"index":null}],"where":[{"type":"expression","format":"binary","variant":"operation","operation":"is not","left":{"type":"identifier","variant":"column","name":"name"},"right":{"type":"literal","variant":"null","value":"null"}}],"group":null,"result":[{"type":"identifier","variant":"column","name":"name","alias":null},{"type":"identifier","variant":"column","name":"color","alias":null},{"type":"identifier","variant":"column","name":"legs","alias":null},{"type":"identifier","variant":"column","name":"id","alias":null}],"distinct":false,"all":false,"order":null,"limit":null}],"temporary":false,"variant":"create","format":"table"}]}';
    tree.equals(resultTree, this, done);
  });

  it('create foreign key 1', function(done) {
    var resultTree = '{"statement":[{"explain":false,"type":"statement","name":{"type":"identifier","variant":"table","name":"bees"},"condition":[],"optimization":[],"definition":[{"type":"definition","variant":"column","name":{"type":"identifier","variant":"column","name":"id"},"definition":[{"name":null,"type":"constraint","variant":"primary key","conflict":null,"direction":null,"modififer":null,"autoIncrement":false}],"datatype":{"type":"datatype","variant":"int","affinity":"integer","args":[]}},{"type":"definition","variant":"column","name":{"type":"identifier","variant":"column","name":"color"},"definition":[],"datatype":{"type":"datatype","variant":"int","affinity":"integer","args":[]}},{"type":"definition","variant":"column","name":{"type":"identifier","variant":"column","name":"hive_id"},"definition":[{"name":null,"type":"constraint","variant":"unique","conflict":null}],"datatype":{"type":"datatype","variant":"int","affinity":"integer","args":[]}},{"type":"definition","variant":"constraint","name":null,"definition":[{"type":"constraint","variant":"foreign key","action":null,"defer":null,"references":{"type":"identifier","variant":"table","name":"hives"}}],"columns":[{"type":"identifier","variant":"column","name":"hive_id"}]}],"temporary":false,"variant":"create","format":"table"}]}';
    tree.equals(resultTree, this, done);
  });

  it('create foreign key 2', function(done) {
    var resultTree = '{"statement":[{"explain":false,"type":"statement","name":{"type":"identifier","variant":"table","name":"bees"},"condition":[],"optimization":[],"definition":[{"type":"definition","variant":"column","name":{"type":"identifier","variant":"column","name":"id"},"definition":[{"name":null,"type":"constraint","variant":"primary key","conflict":null,"direction":null,"modififer":null,"autoIncrement":false}],"datatype":{"type":"datatype","variant":"int","affinity":"integer","args":[]}},{"type":"definition","variant":"column","name":{"type":"identifier","variant":"column","name":"color"},"definition":[],"datatype":{"type":"datatype","variant":"int","affinity":"integer","args":[]}},{"type":"definition","variant":"column","name":{"type":"identifier","variant":"column","name":"hive_id"},"definition":[{"name":null,"type":"constraint","variant":"unique","conflict":null},{"name":null,"variant":"foreign key","type":"constraint","action":null,"defer":null,"references":{"type":"identifier","variant":"expression","format":"table","name":"hives","columns":[{"type":"identifier","variant":"column","name":"id"}]}}],"datatype":{"type":"datatype","variant":"int","affinity":"integer","args":[]}}],"temporary":false,"variant":"create","format":"table"}]}';
    tree.equals(resultTree, this, done);
  });

  it('create check 1', function(done) {
    var resultTree = '{"statement":[{"explain":false,"type":"statement","name":{"type":"identifier","variant":"table","name":"bees"},"condition":[],"optimization":[],"definition":[{"type":"definition","variant":"column","name":{"type":"identifier","variant":"column","name":"id"},"definition":[{"name":null,"type":"constraint","variant":"primary key","conflict":null,"direction":null,"modififer":null,"autoIncrement":false}],"datatype":{"type":"datatype","variant":"int","affinity":"integer","args":[]}},{"type":"definition","variant":"column","name":{"type":"identifier","variant":"column","name":"name"},"definition":[{"name":null,"type":"constraint","variant":"not null","conflict":null},{"name":null,"type":"constraint","variant":"unique","conflict":null}],"datatype":{"type":"datatype","variant":"varchar","affinity":"text","args":[{"type":"literal","variant":"decimal","value":"50"}]}},{"type":"definition","variant":"column","name":{"type":"identifier","variant":"column","name":"wings"},"definition":[{"name":null,"type":"constraint","variant":"check","expression":{"type":"expression","format":"binary","variant":"operation","operation":">=","left":{"type":"identifier","variant":"column","name":"wings"},"right":{"type":"literal","variant":"decimal","value":"2"}}}],"datatype":{"type":"datatype","variant":"int","affinity":"integer","args":[]}},{"type":"definition","variant":"column","name":{"type":"identifier","variant":"column","name":"legs"},"definition":[{"name":null,"type":"constraint","variant":"check","expression":{"type":"expression","format":"binary","variant":"operation","operation":"<","left":{"type":"identifier","variant":"column","name":"legs"},"right":{"type":"literal","variant":"decimal","value":"8"}}}],"datatype":{"type":"datatype","variant":"int","affinity":"integer","args":[]}}],"temporary":false,"variant":"create","format":"table"}]}';
    tree.equals(resultTree, this, done);
  });

  it('create check 2', function(done) {
    var resultTree = '{"statement":[{"explain":false,"type":"statement","name":{"type":"identifier","variant":"table","name":"bees"},"condition":[],"optimization":[],"definition":[{"type":"definition","variant":"column","name":{"type":"identifier","variant":"column","name":"id"},"definition":[{"name":null,"type":"constraint","variant":"primary key","conflict":null,"direction":null,"modififer":null,"autoIncrement":false}],"datatype":{"type":"datatype","variant":"int","affinity":"integer","args":[]}},{"type":"definition","variant":"column","name":{"type":"identifier","variant":"column","name":"name"},"definition":[{"name":null,"type":"constraint","variant":"not null","conflict":null},{"name":null,"type":"constraint","variant":"unique","conflict":null}],"datatype":{"type":"datatype","variant":"varchar","affinity":"text","args":[{"type":"literal","variant":"decimal","value":"50"}]}},{"type":"definition","variant":"column","name":{"type":"identifier","variant":"column","name":"wings"},"definition":[],"datatype":{"type":"datatype","variant":"int","affinity":"integer","args":[]}},{"type":"definition","variant":"column","name":{"type":"identifier","variant":"column","name":"legs"},"definition":[],"datatype":{"type":"datatype","variant":"int","affinity":"integer","args":[]}},{"type":"definition","variant":"constraint","name":null,"definition":[{"type":"constraint","variant":"check","expression":{"type":"expression","format":"binary","variant":"operation","operation":"<","left":{"type":"identifier","variant":"column","name":"legs"},"right":{"type":"literal","variant":"decimal","value":"8"}}}]},{"type":"definition","variant":"constraint","name":null,"definition":[{"type":"constraint","variant":"check","expression":{"type":"expression","format":"binary","variant":"operation","operation":">=","left":{"type":"identifier","variant":"column","name":"wings"},"right":{"type":"literal","variant":"decimal","value":"2"}}}]}],"temporary":false,"variant":"create","format":"table"}]}';
    tree.equals(resultTree, this, done);
  });

  it('create primary key 1', function(done) {
    var resultTree = '{"statement":[{"explain":false,"type":"statement","name":{"type":"identifier","variant":"table","name":"bees"},"condition":[],"optimization":[],"definition":[{"type":"definition","variant":"column","name":{"type":"identifier","variant":"column","name":"id"},"definition":[],"datatype":{"type":"datatype","variant":"int","affinity":"integer","args":[]}},{"type":"definition","variant":"column","name":{"type":"identifier","variant":"column","name":"color"},"definition":[],"datatype":{"type":"datatype","variant":"int","affinity":"integer","args":[]}},{"type":"definition","variant":"column","name":{"type":"identifier","variant":"column","name":"hive_id"},"definition":[{"name":null,"type":"constraint","variant":"unique","conflict":null}],"datatype":{"type":"datatype","variant":"int","affinity":"integer","args":[]}},{"type":"definition","variant":"constraint","name":null,"definition":[{"type":"constraint","variant":"primary key","conflict":"fail"}],"columns":[{"type":"identifier","variant":"column","format":"indexed","direction":null,"name":"id","collate":null}]}],"temporary":false,"variant":"create","format":"table"}]}';
    tree.equals(resultTree, this, done);
  });

  // CREATE INDEX statement

  it('basic create index', function(done) {
    var resultTree = '{"statement":[{"explain":false,"type":"statement","variant":"create","format":"index","target":{"type":"identifier","variant":"index","name":"bees.hive_state"},"where":[{"type":"expression","format":"binary","variant":"operation","operation":">","left":{"type":"identifier","variant":"column","name":"anger"},"right":{"type":"literal","variant":"decimal","value":"0"}}],"on":{"target":"hive","columns":[{"type":"identifier","variant":"column","format":"indexed","direction":"asc","name":"happiness","collate":null},{"type":"identifier","variant":"column","format":"indexed","direction":"desc","name":"anger","collate":null}]},"condition":[],"unique":false}]}';
    tree.equals(resultTree, this, done);
  });

  // CREATE TRIGGER statement

  it('basic create trigger', function(done) {
    var resultTree = '{"statement":[{"explain":false,"type":"statement","when":{"type":"expression","format":"unary","variant":"operation","expression":{"type":"identifier","variant":"column","name":"cust_addr"},"operation":"not null"},"target":{"type":"identifier","variant":"trigger","name":"cust_addr_chng"},"on":"customer_address","condition":[],"event":{"type":"event","occurs":"instead of","event":"update","of":[{"type":"identifier","variant":"column","name":"cust_addr"}]},"by":"row","action":[{"explain":false,"type":"statement","variant":"update","into":{"type":"identifier","variant":"table","name":"customer","alias":null,"index":null},"where":[{"type":"expression","format":"binary","variant":"operation","operation":"=","left":{"type":"identifier","variant":"column","name":"cust_id"},"right":{"type":"identifier","variant":"column","name":"new.cust_id"}}],"set":[{"type":"assignment","target":{"type":"identifier","variant":"column","name":"cust_addr"},"value":{"type":"identifier","variant":"column","name":"new.cust_addr"}}],"order":null,"limit":null,"with":null}],"temporary":false,"variant":"create","format":"trigger"}]}';
    tree.equals(resultTree, this, done);
  });

  it('basic create trigger 2', function(done) {
    var resultTree = '{"statement":[{"explain":false,"type":"statement","when":{"type":"expression","format":"binary","variant":"operation","operation":"==","left":{"type":"identifier","variant":"column","name":"name"},"right":{"type":"literal","variant":"string","value":"Nick"}},"target":{"type":"identifier","variant":"trigger","name":"happy_bee_time"},"on":"bees","condition":[{"type":"condition","condition":"if not exists"}],"event":{"type":"event","occurs":"before","event":"delete"},"by":"row","action":[{"explain":false,"type":"statement","variant":"insert","into":{"type":"identifier","variant":"expression","format":"table","name":"hive","columns":[{"type":"identifier","variant":"column","name":"id"},{"type":"identifier","variant":"column","name":"name"}]},"action":"insert","or":null,"result":[{"type":"values","variant":"list","values":[{"type":"literal","variant":"decimal","value":"4"},{"type":"literal","variant":"string","value":"A Better Hive"}]}],"with":null},{"explain":false,"type":"statement","variant":"insert","into":{"type":"identifier","variant":"expression","format":"table","name":"bees","columns":[{"type":"identifier","variant":"column","name":"name"},{"type":"identifier","variant":"column","name":"color"},{"type":"identifier","variant":"column","name":"hive_id"}]},"action":"insert","or":null,"result":[{"type":"values","variant":"list","values":[{"type":"literal","variant":"string","value":"New Nick"},{"type":"literal","variant":"string","value":"purple"},{"type":"literal","variant":"decimal","value":"4"}]}],"with":null}],"temporary":true,"variant":"create","format":"trigger"}]}';
    tree.equals(resultTree, this, done);
  });

  // CREATE VIEW statement

  it('basic create view', function(done) {
    var resultTree = '{"statement":[{"explain":false,"type":"statement","condition":[],"target":{"type":"identifier","variant":"view","name":"happy.bananaview"},"result":{"type":"statement","variant":"select","from":[{"type":"identifier","variant":"table","name":"bananas","alias":null,"index":null}],"where":[{"type":"expression","format":"binary","variant":"operation","operation":"=","left":{"type":"identifier","variant":"column","name":"color"},"right":{"type":"literal","variant":"string","value":"red"}}],"group":null,"result":[{"type":"identifier","variant":"column","name":"type","alias":null},{"type":"identifier","variant":"column","name":"name","alias":null},{"type":"identifier","variant":"column","name":"origin","alias":null}],"distinct":false,"all":false,"order":null,"limit":null},"temporary":false,"variant":"create","format":"view"}]}';
    tree.equals(resultTree, this, done);
  });

  // CREATE VIRTUAL TABLE statement

  it('basic create virtual table', function(done) {
    var resultTree = '{"statement":[{"explain":false,"type":"statement","variant":"create","format":"virtual","condition":[],"target":{"type":"identifier","variant":"table","name":"happy_table"},"result":{"type":"module","name":"happy_module","args":[{"type":"expression","format":"binary","variant":"operation","operation":"!=","left":{"type":"identifier","variant":"column","name":"some"},"right":{"type":"literal","variant":"string","value":"expression"}},{"type":"literal","variant":"string","value":"just a string"},{"type":"literal","variant":"decimal","value":"33.0"}]}}]}';
    tree.equals(resultTree, this, done);
  });

  it('create virtual table alt syntax', function(done) {
    var resultTree = '{"statement":[{"explain":false,"type":"statement","condition":[],"target":{"type":"identifier","variant":"table","name":"happy_table"},"result":{"type":"module","name":"happy_module","args":[{"type":"definition","variant":"column","name":{"type":"identifier","variant":"column","name":"id"},"definition":[{"name":null,"type":"constraint","variant":"primary key","conflict":null,"direction":null,"modififer":null,"autoIncrement":false}],"datatype":{"type":"datatype","variant":"int","affinity":"integer","args":[]}},{"type":"definition","variant":"column","name":{"type":"identifier","variant":"column","name":"name"},"definition":[],"datatype":{"type":"datatype","variant":"varchar","affinity":"text","args":[{"type":"literal","variant":"decimal","value":"50"}]}},{"type":"definition","variant":"column","name":{"type":"identifier","variant":"column","name":"category"},"definition":[],"datatype":{"type":"datatype","variant":"varchar","affinity":"text","args":[{"type":"literal","variant":"decimal","value":"15"}]}},{"type":"definition","variant":"column","name":{"type":"identifier","variant":"column","name":"cost"},"definition":[],"datatype":{"type":"datatype","variant":"int","affinity":"integer","args":[]}}]},"variant":"create","format":"virtual"}]}';
    tree.equals(resultTree, this, done);
  });

  // DROP statement

  it('basic drop table', function(done) {
    var resultTree = '{"statement":[{"explain":false,"type":"statement","target":{"type":"identifier","variant":"table","name":"beestuff"},"variant":"drop","format":"table","condition":[]}]}';
    tree.equals(resultTree, this, done);
  });

  it('basic drop trigger', function(done) {
    var resultTree = '{"statement":[{"explain":false,"type":"statement","variant":"drop","format":"trigger","target":{"type":"identifier","variant":"trigger","name":"happy.insertRecord"},"condition":[{"type":"condition","condition":"if exists"}]}]}';
    tree.equals(resultTree, this, done);
  });

  it('drop alt syntax', function(done) {
    var resultTree = '{"statement":[{"explain":false,"type":"statement","target":{"type":"identifier","variant":"table","name":"hive.beestuff"},"variant":"drop","format":"table","condition":[{"type":"condition","condition":"if exists"}]}]}';
    tree.equals(resultTree, this, done);
  });

  // Transaction

  it('basic transaction', function(done) {
    var resultTree = '{"statement":[{"explain":false,"type":"statement","variant":"transaction","statement":[{"explain":false,"type":"statement","name":{"type":"identifier","variant":"table","name":"foods"},"condition":[],"optimization":[],"definition":[{"type":"definition","variant":"column","name":{"type":"identifier","variant":"column","name":"id"},"definition":[{"name":null,"type":"constraint","variant":"primary key","conflict":null,"direction":null,"modififer":null,"autoIncrement":false}],"datatype":{"type":"datatype","variant":"int","affinity":"integer","args":[]}},{"type":"definition","variant":"column","name":{"type":"identifier","variant":"column","name":"item"},"definition":[],"datatype":{"type":"datatype","variant":"varchar","affinity":"text","args":[{"type":"literal","variant":"decimal","value":"50"}]}},{"type":"definition","variant":"column","name":{"type":"identifier","variant":"column","name":"size"},"definition":[],"datatype":{"type":"datatype","variant":"varchar","affinity":"text","args":[{"type":"literal","variant":"decimal","value":"15"}]}},{"type":"definition","variant":"column","name":{"type":"identifier","variant":"column","name":"price"},"definition":[],"datatype":{"type":"datatype","variant":"int","affinity":"integer","args":[]}}],"temporary":false,"variant":"create","format":"table"},{"explain":false,"type":"statement","variant":"insert","into":{"type":"identifier","variant":"expression","format":"table","name":"foods","columns":[{"type":"identifier","variant":"column","name":"item"},{"type":"identifier","variant":"column","name":"size"},{"type":"identifier","variant":"column","name":"id"},{"type":"identifier","variant":"column","name":"price"}]},"action":"insert","or":null,"result":{"type":"statement","variant":"select","from":[{"type":"identifier","variant":"table","name":"bananas","alias":null,"index":null}],"where":[{"type":"expression","format":"binary","variant":"operation","operation":"!=","left":{"type":"identifier","variant":"column","name":"color"},"right":{"type":"literal","variant":"string","value":"red"}}],"group":null,"result":[{"type":"literal","variant":"string","value":"banana","alias":null},{"type":"identifier","variant":"column","name":"size","alias":null},{"type":"literal","variant":"null","value":"null","alias":null},{"type":"identifier","variant":"column","name":"price","alias":null}],"distinct":false,"all":false,"order":null,"limit":null},"with":null}],"defer":"immediate"}]}';
    tree.equals(resultTree, this, done);
  });

  it('transaction rollback', function(done) {
    var resultTree = '{"statement":[{"explain":false,"type":"statement","variant":"rollback","to":{"type":"identifier","variant":"savepoint","name":"super_save"}}]}';
    tree.equals(resultTree, this, done);
  });

  it('transaction misc', function(done) {
    var resultTree = '{"statement":[{"explain":false,"type":"statement","variant":"release","target":{"type":"identifier","variant":"savepoint","name":"happy_place"}},{"explain":false,"type":"statement","variant":"release","target":{"type":"identifier","variant":"savepoint","name":"sad_place"}},{"explain":false,"type":"statement","variant":"savepoint","target":{"type":"identifier","variant":"savepoint","name":"bee_time"}}]}';
    tree.equals(resultTree, this, done);
  });

  // Full-featured tests

  it('full featured 1', function(done) {
    var resultTree = '{"statement":[{"explain":false,"type":"statement","name":{"type":"identifier","variant":"table","name":"actors"},"condition":[],"optimization":[],"definition":[{"type":"definition","variant":"column","name":{"type":"identifier","variant":"column","name":"name"},"definition":[],"datatype":{"type":"datatype","variant":"varchar","affinity":"text","args":[{"type":"literal","variant":"decimal","value":"50"}]}},{"type":"definition","variant":"column","name":{"type":"identifier","variant":"column","name":"country"},"definition":[],"datatype":{"type":"datatype","variant":"varchar","affinity":"text","args":[{"type":"literal","variant":"decimal","value":"50"}]}},{"type":"definition","variant":"column","name":{"type":"identifier","variant":"column","name":"salary"},"definition":[],"datatype":{"type":"datatype","variant":"integer","affinity":"integer","args":[]}}],"temporary":false,"variant":"create","format":"table"},{"explain":false,"type":"statement","variant":"insert","into":{"type":"identifier","variant":"expression","format":"table","name":"actors","columns":[{"type":"identifier","variant":"column","name":"name"},{"type":"identifier","variant":"column","name":"country"},{"type":"identifier","variant":"column","name":"salary"}]},"action":"insert","or":null,"result":[{"type":"values","variant":"list","values":[{"type":"literal","variant":"string","value":"Vivien Leigh"},{"type":"literal","variant":"string","value":"IN"},{"type":"literal","variant":"decimal","value":"150000"}]},{"type":"values","variant":"list","values":[{"type":"literal","variant":"string","value":"Clark Gable"},{"type":"literal","variant":"string","value":"USA"},{"type":"literal","variant":"decimal","value":"120000"}]},{"type":"values","variant":"list","values":[{"type":"literal","variant":"string","value":"Olivia de Havilland"},{"type":"literal","variant":"string","value":"Japan"},{"type":"literal","variant":"decimal","value":"30000"}]},{"type":"values","variant":"list","values":[{"type":"literal","variant":"string","value":"Hattie McDaniel"},{"type":"literal","variant":"string","value":"USA"},{"type":"literal","variant":"decimal","value":"45000"}]}],"with":null},{"explain":false,"type":"statement","variant":"select","from":[{"type":"identifier","variant":"table","name":"actors","alias":null,"index":null}],"where":null,"group":null,"result":[{"type":"function","name":"min","distinct":false,"args":[{"type":"identifier","variant":"column","name":"salary"}],"alias":"MinSalary"},{"type":"function","name":"max","distinct":false,"args":[{"type":"identifier","variant":"column","name":"salary"}],"alias":"MaxSalary"}],"distinct":false,"all":false,"order":null,"limit":null,"with":null}]}';
    tree.equals(resultTree, this, done);
  });

  it('full featured 2', function(done) {
    var resultTree = '{"statement":[{"explain":false,"type":"statement","name":{"type":"identifier","variant":"table","name":"actors"},"condition":[],"optimization":[],"definition":[{"type":"definition","variant":"column","name":{"type":"identifier","variant":"column","name":"id"},"definition":[{"name":null,"type":"constraint","variant":"primary key","conflict":null,"direction":null,"modififer":null,"autoIncrement":false}],"datatype":{"type":"datatype","variant":"int","affinity":"integer","args":[]}},{"type":"definition","variant":"column","name":{"type":"identifier","variant":"column","name":"name"},"definition":[{"name":null,"type":"constraint","variant":"not null","conflict":null},{"name":null,"type":"constraint","variant":"unique","conflict":null}],"datatype":{"type":"datatype","variant":"varchar","affinity":"text","args":[{"type":"literal","variant":"decimal","value":"50"}]}}],"temporary":false,"variant":"create","format":"table"},{"explain":false,"type":"statement","variant":"insert","into":{"type":"identifier","variant":"expression","format":"table","name":"actors","columns":[{"type":"identifier","variant":"column","name":"name"}]},"action":"insert","or":null,"result":[{"type":"values","variant":"list","values":[{"type":"literal","variant":"string","value":"Vivien Leigh"}]},{"type":"values","variant":"list","values":[{"type":"literal","variant":"string","value":"Clark Gable"}]},{"type":"values","variant":"list","values":[{"type":"literal","variant":"string","value":"Olivia de Havilland"}]}],"with":null},{"explain":false,"type":"statement","name":{"type":"identifier","variant":"table","name":"movies"},"condition":[],"optimization":[],"definition":[{"type":"definition","variant":"column","name":{"type":"identifier","variant":"column","name":"id"},"definition":[{"name":null,"type":"constraint","variant":"primary key","conflict":null,"direction":null,"modififer":null,"autoIncrement":false}],"datatype":{"type":"datatype","variant":"int","affinity":"integer","args":[]}},{"type":"definition","variant":"column","name":{"type":"identifier","variant":"column","name":"title"},"definition":[{"name":null,"type":"constraint","variant":"not null","conflict":null},{"name":null,"type":"constraint","variant":"unique","conflict":null}],"datatype":{"type":"datatype","variant":"varchar","affinity":"text","args":[{"type":"literal","variant":"decimal","value":"50"}]}}],"temporary":false,"variant":"create","format":"table"},{"explain":false,"type":"statement","variant":"insert","into":{"type":"identifier","variant":"expression","format":"table","name":"movies","columns":[{"type":"identifier","variant":"column","name":"title"}]},"action":"insert","or":null,"result":[{"type":"values","variant":"list","values":[{"type":"literal","variant":"string","value":"Don Juan"}]},{"type":"values","variant":"list","values":[{"type":"literal","variant":"string","value":"The Lost World"}]},{"type":"values","variant":"list","values":[{"type":"literal","variant":"string","value":"Peter Pan"}]},{"type":"values","variant":"list","values":[{"type":"literal","variant":"string","value":"Robin Hood"}]},{"type":"values","variant":"list","values":[{"type":"literal","variant":"string","value":"Wolfman"}]}],"with":null},{"explain":false,"type":"statement","name":{"type":"identifier","variant":"table","name":"actors_movies"},"condition":[],"optimization":[],"definition":[{"type":"definition","variant":"column","name":{"type":"identifier","variant":"column","name":"actor_id"},"definition":[{"name":null,"variant":"foreign key","type":"constraint","action":null,"defer":null,"references":{"type":"identifier","variant":"table","name":"actors"}}],"datatype":{"type":"datatype","variant":"int","affinity":"integer","args":[]}},{"type":"definition","variant":"column","name":{"type":"identifier","variant":"column","name":"movie_id"},"definition":[{"name":null,"variant":"foreign key","type":"constraint","action":null,"defer":null,"references":{"type":"identifier","variant":"table","name":"movies"}}],"datatype":{"type":"datatype","variant":"int","affinity":"integer","args":[]}}],"temporary":false,"variant":"create","format":"table"},{"explain":false,"type":"statement","variant":"insert","into":{"type":"identifier","variant":"expression","format":"table","name":"actors_movies","columns":[{"type":"identifier","variant":"column","name":"actor_id"},{"type":"identifier","variant":"column","name":"movie_id"}]},"action":"insert","or":null,"result":[{"type":"values","variant":"list","values":[{"type":"literal","variant":"decimal","value":"2"},{"type":"literal","variant":"decimal","value":"5"}]}],"with":null}]}';
    tree.equals(resultTree, this, done);
  });

  // Parse error

  it('parse error 1', function(done) {
    tree.error({
      'message': 'Syntax error found near Column Identifier (WHERE Clause)'
    }, this, done);
  });

  // SQL comments

  it('comments', function (done) {
    var resultTree = '{"statement":[{"explain":false,"type":"statement","variant":"select","from":[],"where":null,"group":null,"result":[{"type":"literal","variant":"decimal","value":"1","alias":null}],"distinct":false,"all":false,"order":null,"limit":null,"with":null},{"explain":false,"type":"statement","variant":"select","from":[{"type":"identifier","variant":"table","name":"rooms","alias":"hat","index":null}],"where":[{"type":"expression","format":"binary","variant":"operation","operation":">","left":{"type":"identifier","variant":"column","name":"seats"},"right":{"type":"literal","variant":"decimal","value":"75"}}],"group":null,"result":[{"type":"identifier","variant":"column","name":"movie_id","alias":null}],"distinct":false,"all":false,"order":null,"limit":null,"with":null},{"explain":false,"type":"statement","variant":"select","from":[{"type":"identifier","variant":"table","name":"hats","alias":null,"index":null}],"where":null,"group":null,"result":[{"type":"literal","variant":"decimal","value":"2","alias":null}],"distinct":false,"all":false,"order":null,"limit":null,"with":null}]}';
    tree.equals(resultTree, this, done);
  });

  // SQLite-specific and internal

  it('basic pragma', function (done) {
    var resultTree = '{"statement":[{"explain":false,"type":"statement","variant":"pragma","target":{"type":"identifier","variant":"pragma","name":"hat.pants"},"args":[{"type":"literal","variant":"string","value":"some string"}]},{"explain":false,"type":"statement","variant":"pragma","target":{"type":"identifier","variant":"pragma","name":"pants.pants"},"args":[{"type":"literal","variant":"decimal","value":"+200.00"}]},{"explain":false,"type":"statement","variant":"pragma","target":{"type":"identifier","variant":"pragma","name":"nap.times"},"args":[]},{"explain":false,"type":"statement","variant":"pragma","target":{"type":"identifier","variant":"pragma","name":"suit"},"args":[{"type":"literal","variant":"boolean","normalized":"0","value":"no"}]}]}';
    tree.equals(resultTree, this, done);
  });

  it('basic sqlite', function (done) {
    var resultTree = '{"statement":[{"explain":false,"type":"statement","variant":"detach","target":{"type":"identifier","variant":"database","name":"hat_db"}},{"explain":false,"type":"statement","variant":"detach","target":{"type":"identifier","variant":"database","name":"pants_db"}},{"explain":false,"type":"statement","variant":"reindex","target":"happy_collation"},{"explain":false,"type":"statement","variant":"reindex","target":null},{"explain":false,"type":"statement","variant":"reindex","target":"hat_db.pants_table"},{"explain":false,"type":"statement","variant":"analyze","target":"happy_table"},{"explain":false,"type":"statement","variant":"analyze","target":null},{"explain":false,"type":"statement","variant":"analyze","target":"hat_db.pants_table"},{"explain":false,"type":"statement","variant":"vacuum"}]}';
    tree.equals(resultTree, this, done);
  });

});
